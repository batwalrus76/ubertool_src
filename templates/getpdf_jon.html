<script src="/stylesheets/jquery-1.9.1.min.js" type="text/javascript"></script>
<!-- Import jQueryUI library -->
<script src="/stylesheets/jquery-ui.js" type="text/javascript"></script>
<script src="https://raw.github.com/malsup/blockui/master/jquery.blockUI.js" type="text/javascript"></script>

<script>
$(document).ready(function () {
var jq_html = $('<div />').append($("div.articles_output").children('table[class*=out_]:not(div#chart1,table:hidden)').clone()).html();
var n_plot=$('div[id^="chart"]').size()

i=1;
var imgData = [];
while(i <= n_plot){
    imgData.push($('#chart'+i).jqplotToImageStr({}));
    i=i+1    
}
imgData_json = JSON.stringify(imgData)

// var jq_html = ($("div.articles_output").clone()).html();


// console.log(jq_html)
// console.log(n_plot)


	$('<tr style="display:none"><td><input type="hidden" name="pdf_t"></td></tr>')
    .appendTo('.getpdf')
    .find('input')
    .val(jq_html);

	$('<tr style="display:none"><td><input type="hidden" name="pdf_nop"></td></tr>')
    .appendTo('.getpdf')
    .find('input')
    .val(n_plot);

	$('<tr style="display:none"><td><input type="hidden" name="pdf_p"></td></tr>')
    .appendTo('.getpdf')
    .find('input')
    .val(imgData_json);

	/*$('.getpdf').append('<tr><td><input type="submit" value="Generate PDF"/></td></tr>');*/

var browserWidth = $(window).width();
var browserHeight = $(window).height();
var winleft = (browserWidth / 2) - 200 + "px";
var wintop = (browserHeight / 2) - 30 + "px";
var divTop = ($('.articles_output').height() * 0.5) - 28.5 + "px";
var doneDiv = document.getElementById("popup");

    $('#pdfExport').click(function () {
        // var win = window.open('/templates/popup.html', 'PDF_Export', 'width=450,height=300,status=yes,resizable=yes,scrollbars=yes,left='+ winleft +',top='+ wintop +'');

        // $.blockUI({ 
        //     message: '<h1>Loading!</h1>', 
        //     timeout: 2000
            // css: { 

            //     backgroundColor: '#000', 

            //     opacity: .6, 
            //     color: '#fff' 
            // } 

        // }); 

		// $('#pdf_post').submit();

		$(document).ajaxStart(function(){
			$.blockUI({
				css:{ "top":""+wintop+"", "left":""+winleft+"", "margin-top": "4px", "padding": "30px 20px", "width": "400px", "height": "60px", "border": "0 none", "border-radius": "4px", "-webkit-border-radius": "4px", "-moz-border-radius": "4px", "box-shadow": "3px 3px 15px #333", "-webkit-box-shadow": "3px 3px 15px #333", "-moz-box-shadow": "3px 3px 15px #333" },
				message: '<h2 class="model_header">Generating PDF...</h2><br><img src="/images/loader.gif" style="margin-top:-15px">',
			});
		});

        $(document).ajaxStop(function(){
	        $.blockUI( { message: null, fadeIn: 0, } );
	        $("#popup").show();
	        $("#export_link").fadeIn(500);
	        $("#popup_pdf").css({"top":""+wintop+""});
	        $("#export_link").click(function (){
	        	$("#popup").hide();
	        	$.unblockUI();
	        });

		});

		// $(document).ajaxStop(function(){ 
		//   alert('Done');
		// });

    	

		$.ajax({

				type: "post",
				url: "/pdf.html",
				data: $("#pdf_post").serialize(),
				dataType: "html",

		       // beforeSend: alert('Please Wait'),


			   success: function(data) {
			   	    // var win = window.open();
			   	    // var win = window.open('/templates/popup.html', 'PDF_Export', 'width=450,height=300,status=yes,resizable=yes,scrollbars=yes,left='+ winleft +',top='+ wintop +'');
            		// doneDiv.document.write(data);
            		doneDiv.innerHTML = data;
				}

		});

/*
	$('.popup').click(function(event) {
		var url = $(this).attr("href");
		window.open(url, "popUp", "width=300, height=300")
		event.preventDefault();
	});

	$('#fadeExport_pdf').append('<span class="hover"></span>').each(function () {
		var $span = $('> span.hover', this).css('opacity', 0);
		$(this).hover(function () {
			$span.stop().fadeTo(500, 1);
		}, function () {
			$span.stop().fadeTo(500, 0);
		});
	});
	
	$('#fadeExport_html').append('<span class="hover"></span>').each(function () {
		var $span = $('> span.hover', this).css('opacity', 0);
		$(this).hover(function () {
			$span.stop().fadeTo(500, 1);
		}, function () {
			$span.stop().fadeTo(500, 0);
		});
	});
	
	$('#fadeExport_doc').append('<span class="hover"></span>').each(function () {
		var $span = $('> span.hover', this).css('opacity', 0);
		$(this).hover(function () {
			$span.stop().fadeTo(500, 1);
		}, function () {
			$span.stop().fadeTo(500, 0);
		});
	});
*/
	});

});
</script>



<!-- <form id="pdf_post" method="post" action="pdf.html" target="PDF_Export"> -->

<form id="pdf_post" method="post"  target="PDF_Export">
	<table align="center" class="getpdf popup"></table>
</form>
