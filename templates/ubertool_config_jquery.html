<script type="text/javascript" src=" ../stylesheets/jquery-1.7.2.js"></script>
<script type="text/javascript" src=" ../stylesheets/jquery.validate.js"></script>

<script>
function submitBatchConfigurations()
{
	var document_form = document.forms[0];
	var batch_size = (document_form.length-3)/8;
	var form_data = {};
	for(i = batch_size + 1; i < document_form.length - 2; i++)
	{
		var id = (document_form[i].id).replace("id_","");
		var val = document_form[i].value;
		form_data[id] = val;
	}
	var batch_config_props = null;
	$.ajax({
		url:"ubertool-batch-configuration",
		async: false,
		type: 'POST',
		data: JSON.stringify(form_data),
		success: function(form_data) {
			batch_config_props = form_data
		}
	});
	var batch_config_name = null
	if(batch_config_props != null)
	{
		$.ajax({
			url:"{{ ubertool_server }}batch",
			async: false,
			contentType:"application/json; charset=utf-8",
			type: 'POST',
			data: JSON.stringify(batch_config_props),
			success: function(batch_data) {
				batch_config_name = batch_data;
			}
		});
	}
	window.location = "user.html";

}

function endsInInteger(str)
{
	var lastChar = str.charCodeAt(str.length-1);
	var lastCharInt = false;
	if(lastChar > 47 && lastChar < 58)
	{
		lastCharInt - true;
	}
	return lastCharInt;
}

function updateUbertoolConfigurations(sel)
{
	var user_ubertool_configuration_id = sel.id;
	var user_ubertool_configuration = $("#"+user_ubertool_configuration_id)[0].value;
	if(user_ubertool_configuration != 'None')
	{
		var configuration_suffix = "";
		var underscore_index = user_ubertool_configuration_id.lastIndexOf("_");
		if(underscore_index !== -1 && user_ubertool_configuration_id != "id_user_ubertool_configuration")
		{
			configuration_suffix = user_ubertool_configuration_id.substring(underscore_index);
		}
		$.ajax({
			url:"ubertool/"+user_ubertool_configuration,
			async: false,
			type: 'GET',
			success: function(ubertool_data) {
				// application type select dropdown
				var use_config = ubertool_data['use'];
				if(use_config != null)
				{
					s = document.getElementById('id_use_configuration'+configuration_suffix);
					s.value = use_config;
				}
				var pest_config = ubertool_data['pest'];
				if(pest_config != null)
				{
					s = document.getElementById('id_pest_configuration'+configuration_suffix);
					s.value = pest_config;
				}
				var expo_config = ubertool_data['expo'];
				if(expo_config != null)
				{
					s = document.getElementById('id_exposures_configuration'+configuration_suffix);
					s.value = expo_config;
				}
				var aqua_config = ubertool_data['aqua'];
				if(aqua_config != null)
				{
					s = document.getElementById('id_aquatic_configuration'+configuration_suffix);
					s.value = aqua_config;
				}
				var terra_config = ubertool_data['terra'];
				if(terra_config != null)
				{
					s = document.getElementById('id_terrestrial_configuration'+configuration_suffix);
					s.value = terra_config;
				}
				var eco_config = ubertool_data['eco'];
				if(eco_config != null)
				{
					s = document.getElementById('id_ecosystems_configuration'+configuration_suffix);
					s.value = eco_config;
				}
				$("#id_config_name"+configuration_suffix)[0].value = $("#"+user_ubertool_configuration_id)[0].value;					
			}
		});
	}
}
</script>
<script>
$(document).ready(function() {
	num_ubertool_runs = 1;
	
	$.ajax({
		url:"ubertool",
		async: false,
		type: 'GET',
		success: function(use_data) {
			var config_names = use_data['config_names'];
			if(config_names != null)
			{
				for(i = 0; i < config_names.length; i++)
				{
					var config_name = config_names[i];
					if(config_name != "None" && config_name != null)
					{
						$("#id_user_ubertool_configuration").append(new Option(config_name, config_name));
					}
				}
			}
		}
	});
	
	$.ajax({
		url:"use-config-names",
		async: false,
		type: 'GET',
		success: function(use_data) {
			var config_names = use_data['config_names'];
			if(config_names != null)
			{
				for(i = 0; i < config_names.length; i++)
				{
					var config_name = config_names[i];
					if(config_name != "None")
					{
						$("#id_use_configuration").append(new Option(config_name, config_name));
					}
				}
			}
		}
	});
	
	$.ajax({
		url:"aqua-config-names",
		async: false,
		type: 'GET',
		success: function(aqua_data) {
			var config_names = aqua_data['config_names'];
			if(config_names != null)
			{
				for(i = 0; i < config_names.length; i++)
				{
					var config_name = config_names[i];
					if(config_name != "None")
					{
						$("#id_aquatic_configuration").append(new Option(config_name, config_name));
					}
				}
			}
		}
	});	
	
	$.ajax({
		url:"eco-config-names",
		async: false,
		type: 'GET',
		success: function(eco_data) {
			var config_names = eco_data['config_names'];
			if(config_names != null)
			{
				for(i = 0; i < config_names.length; i++)
				{
					var config_name = config_names[i];
					if(config_name != "None")
					{
						$("#id_ecosystems_configuration").append(new Option(config_name, config_name));
					}
				}
			}
		}
	});
	
	$.ajax({
		url:"expo-config-names",
		async: false,
		type: 'GET',
		success: function(expo_data) {
			var config_names = expo_data['config_names'];
			if(config_names != null)
			{
				for(i = 0; i < config_names.length; i++)
				{
					var config_name = config_names[i];
					if(config_name != "None")
					{
						$("#id_exposures_configuration").append(new Option(config_name, config_name));
					}
				}
			}
		}
	});
	
	$.ajax({
		url:"pest-config-names",
		async: false,
		type: 'GET',
		success: function(pest_data) {
			var config_names = pest_data['config_names'];
			if(config_names != null)
			{
				for(i = 0; i < config_names.length; i++)
				{
					var config_name = config_names[i];
					if(config_name != "None")
					{
						$("#id_pest_configuration").append(new Option(config_name, config_name));
					}
				}
			}
		}
	});
	
	$.ajax({
		url:"terra-config-names",
		async: false,
		type: 'GET',
		success: function(terra_data) {
			var config_names = terra_data['config_names'];
			if(config_names != null)
			{
				for(i = 0; i < config_names.length; i++)
				{
					var config_name = config_names[i];
					if(config_name != "None")
					{
						$("#id_terrestrial_configuration").append(new Option(config_name, config_name));
					}
				}
			}
		}
	});
	
	$(".new_ubertool_run").click(function(){
		//Update ubertool config with multiple selectors
		var ubertool_parameters = {};
		var ubertool_form = document.forms[0];
		for(var i = 0; i < ubertool_form.length; i++)
		{
			var ubertool_item = ubertool_form[i];
			if(ubertool_item.type == "select-one")
			{
				var ubertool_val = ubertool_item.value;
				ubertool_parameters[ubertool_item.id]=ubertool_val;
			}
		}
		var new_ubertool_name = "user_ubertool_configuration_"+num_ubertool_runs;
		var id_new_ubertool_name = "id_user_ubertool_configuration_"+num_ubertool_runs;
		var added_ubertool_select = "<select name='"  + new_ubertool_name + "' id='" + id_new_ubertool_name + "' style='width:120px' onchange=updateUbertoolConfigurations(this)><option value='None'>None</option></select>"	
		var ubertool_select_inner_html = $("#ubertool_select")[0].innerHTML;
		ubertool_select_inner_html += added_ubertool_select;
		$("#ubertool_select")[0].innerHTML = ubertool_select_inner_html;
		$.ajax({
			url:"ubertool",
			async: false,
			type: 'GET',
			success: function(use_data) {
				var config_names = use_data['config_names'];
				if(config_names != null)
				{
					for(i = 0; i < config_names.length; i++)
					{
						var config_name = config_names[i];
						if(config_name != "None" && config_name != null)
						{
							$("#"+id_new_ubertool_name).append(new Option(config_name, config_name));
						}
					}
				}
			}
		});
		var new_ubertool_input_name = "config_name_"+num_ubertool_runs;
		var id_new_ubertool_input_name = "id_config_name_"+num_ubertool_runs;
		var added_ubertool_input = "<input name='"  + new_ubertool_input_name + "' id='" + id_new_ubertool_input_name + "' value='ubertool-config-"+num_ubertool_runs+"' style='width:116px'/>"	
		var ubertool_input_inner_html = $("#ubertool_input")[0].innerHTML;
		ubertool_input_inner_html += added_ubertool_input;
		$("#ubertool_input")[0].innerHTML = ubertool_input_inner_html;
		var new_use_name = "use_configuration_"+num_ubertool_runs;
		var id_new_use_name = "id_use_configuration_"+num_ubertool_runs;
		var added_use_select = "<select name='"  + new_use_name + "' id='" + id_new_use_name + "' style='width:120px'><option value='None'>None</option></select>"	
		var use_select_inner_html = $("#use_select")[0].innerHTML;
		use_select_inner_html += added_use_select;
		$("#use_select")[0].innerHTML = use_select_inner_html;
		$.ajax({
			url:"use-config-names",
			async: false,
			type: 'GET',
			success: function(use_data) {
				var config_names = use_data['config_names'];
				if(config_names != null)
				{
					for(i = 0; i < config_names.length; i++)
					{
						var config_name = config_names[i];
						if(config_name != "None")
						{
							$("#"+id_new_use_name).append(new Option(config_name, config_name));
						}
					}
				}
			}
		});
		var new_pest_name = "pest_configuration_"+num_ubertool_runs;
		var id_new_pest_name = "id_pest_configuration_"+num_ubertool_runs;
		var added_pest_select = "<select name='"  + new_pest_name + "' id='" + id_new_pest_name + "' style='width:120px'><option value='None'>None</option></select>"	
		var pest_select_inner_html = $("#pest_select")[0].innerHTML;
		pest_select_inner_html += added_pest_select;
		$("#pest_select")[0].innerHTML = pest_select_inner_html;
		$.ajax({
			url:"pest-config-names",
			async: false,
			type: 'GET',
			success: function(pest_data) {
				var config_names = pest_data['config_names'];
				if(config_names != null)
				{
					for(i = 0; i < config_names.length; i++)
					{
						var config_name = config_names[i];
						if(config_name != "None")
						{
							$("#"+id_new_pest_name).append(new Option(config_name, config_name));
						}
					}
				}
			}
		});
		var new_exposures_name = "exposures_configuration_"+num_ubertool_runs;
		var id_new_exposures_name = "id_exposures_configuration_"+num_ubertool_runs;
		var added_exposures_select = "<select name='"  + new_exposures_name + "' id='" + id_new_exposures_name + "' style='width:120px'><option value='None'>None</option></select>"	
		var exposures_select_inner_html = $("#exposure_select")[0].innerHTML;
		exposures_select_inner_html += added_exposures_select;
		$("#exposure_select")[0].innerHTML = exposures_select_inner_html;
		$.ajax({
			url:"expo-config-names",
			async: false,
			type: 'GET',
			success: function(expo_data) {
				var config_names = expo_data['config_names'];
				if(config_names != null)
				{
					for(i = 0; i < config_names.length; i++)
					{
						var config_name = config_names[i];
						if(config_name != "None")
						{
							$("#"+id_new_exposures_name).append(new Option(config_name, config_name));
						}
					}
				}
			}
		});
		var new_aquatic_name = "aquatic_configuration_"+num_ubertool_runs;
		var id_new_aquatic_name = "id_aquatic_configuration_"+num_ubertool_runs;
		var added_aquatic_select = "<select name='"  + new_aquatic_name + "' id='" + id_new_aquatic_name + "' style='width:120px'><option value='None'>None</option></select>"	
		var aquatic_select_inner_html = $("#aquatic_select")[0].innerHTML;
		aquatic_select_inner_html += added_aquatic_select;
		$("#aquatic_select")[0].innerHTML = aquatic_select_inner_html;
		$.ajax({
			url:"aqua-config-names",
			async: false,
			type: 'GET',
			success: function(aqua_data) {
				var config_names = aqua_data['config_names'];
				if(config_names != null)
				{
					for(i = 0; i < config_names.length; i++)
					{
						var config_name = config_names[i];
						if(config_name != "None")
						{
							$("#"+id_new_aquatic_name).append(new Option(config_name, config_name));
						}
					}
				}
			}
		});	
		var new_terrestrial_name = "terrestrial_configuration_"+num_ubertool_runs;
		var id_new_terrestrial_name = "id_terrestrial_configuration_"+num_ubertool_runs;
		var added_terrestrial_select = "<select name='"  + new_terrestrial_name + "' id='" + id_new_terrestrial_name + "' style='width:120px'><option value='None'>None</option></select>"	
		var terrestrial_select_inner_html = $("#terrestrial_select")[0].innerHTML;
		terrestrial_select_inner_html += added_terrestrial_select;
		$("#terrestrial_select")[0].innerHTML = terrestrial_select_inner_html;
		$.ajax({
			url:"terra-config-names",
			async: false,
			type: 'GET',
			success: function(terra_data) {
				var config_names = terra_data['config_names'];
				if(config_names != null)
				{
					for(i = 0; i < config_names.length; i++)
					{
						var config_name = config_names[i];
						if(config_name != "None")
						{
							$("#"+id_new_terrestrial_name).append(new Option(config_name, config_name));
						}
					}
				}
			}
		});
		var new_ecosystems_name = "ecosystems_configuration_"+num_ubertool_runs;
		var id_new_ecosystems_name = "id_ecosystems_configuration_"+num_ubertool_runs;
		var added_ecosystems_select = "<select name='"  + new_ecosystems_name + "' id='" + id_new_ecosystems_name + "' style='width:120px'><option value='None'>None</option></select>"	
		var ecosystems_select_inner_html = $("#ecosystem_select")[0].innerHTML;
		ecosystems_select_inner_html += added_ecosystems_select;
		$("#ecosystem_select")[0].innerHTML = ecosystems_select_inner_html;
		$.ajax({
			url:"eco-config-names",
			async: false,
			type: 'GET',
			success: function(eco_data) {
				var config_names = eco_data['config_names'];
				if(config_names != null)
				{
					for(i = 0; i < config_names.length; i++)
					{
						var config_name = config_names[i];
						if(config_name != "None")
						{
							$("#"+id_new_ecosystems_name).append(new Option(config_name, config_name));
						}
					}
				}
			}
		});
		for(var ubertool_param_key in ubertool_parameters)
		{		
			ubertool_form[ubertool_param_key].value = ubertool_parameters[ubertool_param_key];
		}
		num_ubertool_runs += 1;
	});
})
</script>